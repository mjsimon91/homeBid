var cloudinary = require('cloudinary');
var db = require("../models");

cloudinary.config({
  cloud_name: 'djpwgdow6',
  api_key: '119125437867478',
  api_secret: '3Bqk7iZ4jp-xQNx43QJI5SPGNFk'
});

module.exports = function(app) {

  app.post('/api/uploads', function(req, res) {

    console.log('\n**DID ANYTHING HAPPEN???**\n');

    if (!req.files)
      return res.status(400).send('No files were uploaded.');

    // The name of the input field (i.e. "sampleFile") is used to retrieve the uploaded file
    let imgFile = req.files.imgFile;
    console.log(imgFile);

    // cloudinary stuff here
    // File upload
    cloudinary.uploader.upload('imgFile', {
      tags: 'home_img'
    }, function(err, image) {
      console.log();
      console.log("** File Upload");
      if (err) {
        console.warn(err);
      }
      console.log("* public_id for the uploaded image is generated by Cloudinary's service.");
      console.log("* " + image.public_id);
      console.log("* " + image.url);
      waitForAllUploads("imgFile", err, image);
    });
  });

}
